from django.shortcuts import render
from django.http import HttpResponse
from django.conf import settings
import os, sys, time
from django.http import HttpResponseRedirect

MALW_PATH = "./toTrain/Malw/file_"
NOMALW_PATH = "./toTrain/NoMalw/file_"

def loadForm(request):
	return render(request, "form.html", {})

def uploadMalw(request):
	def process(f, malw=True):
		url = MALW_PATH
		if not malw:
			url = NOMALW_PATH

		with open(url + str(count) + '.exe', 'wb+') as destination:
			for chunk in f.chunks():
				destination.write(chunk)

	for count, x in enumerate(request.FILES.getlist("filesMalw")):
		process(x, True)

def uploadNoMalw(request):
	def process(f, malw=True):	
		url = MALW_PATH
		if not malw:
			url = NOMALW_PATH

		with open(url + str(count) + '.exe', 'wb+') as destination:
			for chunk in f.chunks():
				destination.write(chunk)

	for count, x in enumerate(request.FILES.getlist("filesNoMalw")):
		process(x, False)

def uploadAll(request):
	uploadMalw(request)
	uploadNoMalw(request)
	return HttpResponseRedirect('/train/training/')

def training(request):
	from WMD import WMD
	trace = WMD().train()
	"""
	context = {'trace':trace}
	return render(request, 'trained.html', context)
	"""
	return render(request, 'trained.html', {})
