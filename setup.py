#!/usr/bin/env python
# -*- coding: utf-8 -*-
from os import chdir,system,remove
import tarfile
from zipfile import ZipFile
from urllib import urlretrieve
import logging
from sys import argv

urls_install = {"gensim":"https://pypi.python.org/packages/source/g/gensim/gensim-0.12.3.tar.gz",
				"numpy":"https://pypi.python.org/packages/source/n/numpy/numpy-1.10.1.tar.gz",
				"scipy":"https://pypi.python.org/packages/source/s/scipy/scipy-0.16.1.tar.gz",
				"pefile":"http://pefile.googlecode.com/files/pefile-1.2.10-139.tar.gz",
				"pydasm":"http://downloads.sourceforge.net/project/winappdbg/additional%20packages/PyDasm/PyDasm-1.5-precompiled.zip?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fwinappdbg%2Ffiles%2Fadditional%2520packages%2FPyDasm%2F&ts=1448910259&use_mirror=freefr"
			   }

dirs_install = {"numpy":"numpy-1.10.1",
				"scipy":"scipy-0.16.1",
				"gensim":"gensim-0.12.3",
				"pefile":"pefile-1.2.10-139",
				"pydasm":"PyDasm-1.5-precompiled"
			   }

def install_numpy():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Installing numpy...")
	chdir(dirs_install["numpy"])
	system("python setup.py install")
	chdir("../")
	logging.info("Numpy installed!")
	
	
def install_scipy():
	logging.info("Installing scipy...")
	chdir(dirs_install["scipy"])
	system("python setup.py install")
	chdir("../")
	logging.info("scipy installed!")
	
def install_gensim():
	logging.info("Installing gensim...")
	chdir(dirs_install["gensim"])
	system("python setup.py install")
	chdir("../")
	logging.info("gensim installed!")
	
def install_pefile():
	logging.info("Installing pefile...")
	chdir(dirs_install["pefile"])
	system("python setup.py install")
	chdir("../")
	logging.info("pefile installed!")
	
def install_pydasm():
	logging.info("Installing pydasm...")
	chdir(dirs_install["pydasm"])
	system("python setup.py install")
	chdir("../")
	logging.info("pydasm installed!")
	
def download_numpy():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Download numpy...")
	urlretrieve(urls_install["numpy"],dirs_install["numpy"]+".tgz")
	logging.info("Downloaded!")
	logging.info("Decompress numpy...")
	tar = tarfile.open(dirs_install["numpy"]+".tgz")
	tar.extractall()
	tar.close()
	remove(dirs_install["numpy"]+".tgz")
	logging.info("Decompressed and removed!")
	
def download_scipy():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Download scipy...")
	urlretrieve(urls_install["scipy"],dirs_install["scipy"]+".tgz")
	logging.info("Downloaded!")
	logging.info("Decompress scipy...")
	tar = tarfile.open(dirs_install["scipy"]+".tgz")
	tar.extractall()
	tar.close()
	remove(dirs_install["scipy"]+".tgz")
	logging.info("Decompressed and removed!")
	
def download_gensim():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Download numpy...")
	urlretrieve(urls_install["gensim"],dirs_install["gensim"]+".tgz")
	logging.info("Downloaded!")
	logging.info("Decompress gensim...")
	tar = tarfile.open(dirs_install["gensim"]+".tgz")
	tar.extractall()
	tar.close()
	remove(dirs_install["gensim"]+".tgz")
	logging.info("Decompressed and removed!")
	
def download_pefile():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Download pefile...")
	urlretrieve(urls_install["pefile"],dirs_install["pefile"]+".tgz")
	logging.info("Downloaded!")
	logging.info("Decompress pefile...")
	tar = tarfile.open(dirs_install["pefile"]+".tgz")
	tar.extractall()
	tar.close()
	remove(dirs_install["pefile"]+".tgz")
	logging.info("Decompressed and remove!")
	
def download_pydasm():
	logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)
	logging.info("Download pydasm...")
	urlretrieve(urls_install["pydasm"],dirs_install["pydasm"]+".zip")
	logging.info("Downloaded!")
	logging.info("Decompress pydasm...")
	with ZipFile(dirs_install["pydasm"]+".zip","r") as fd:
		fd.extractall()
	fd.close()
	remove(dirs_install["pydasm"]+".zip")
	logging.info("Decompressed and removed!")
	
if __name__ == "__main__":
	if len(argv)!=2 and argv[2]=="--install": print "Usage: python setup.py --install"; exit()
	else:
		download_numpy()
		download_scipy()
		download_gensim()
		download_pefile()
		download_pydasm()
		install_numpy()
		install_scipy()
		install_gensim()
		install_pefile()
		install_pydasm()
